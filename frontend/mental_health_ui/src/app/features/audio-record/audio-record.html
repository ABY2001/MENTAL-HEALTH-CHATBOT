<!-- <app-sidebar></app-sidebar> -->

<div class="chat-page common-color">
  <div class="chat-container">
    <div class="chat-header">
      <h2 class="fs-1 fw-bold"> Mental Health Support</h2>
      <p class="fs-2 fw-normal">I'm here to listen and support you</p>
      <div class="emotion-status">
        {{ emotionStatus }}
      </div>
    </div>

    <div class="messages-container" #messagesContainer>
      <div 

        *ngFor="let message of messages" 
        class="message"
        [class.user]="message.isUser"
        [class.bot]="!message.isUser">
        <div class="message-bubble">
          <div class="message-text fw-bolder">{{ message.text }}</div>
          <div 
            *ngIf="message.emotion && message.isUser" 
            class="emotion-badge fw-normal"
            [ngClass]="getEmotionClass(message.emotion)">
            Detected: {{ message.emotion }}
          </div>
          <div class="message-time">{{ message.time }}</div>
        </div>
      </div>

      <div class="typing-indicator" [class.active]="isTyping">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>

    <!-- Audio Preview Modal -->
    <div class="audio-preview-modal" *ngIf="showAudioPreview">
      <div class="preview-content">
        <div class="preview-header">
          <h3>ğŸ¤ Review Your Recording</h3>
          <p>Listen before sending</p>
        </div>

        <div class="audio-player-container">
          <audio 
            #audioPlayer
            [src]="audioURL" 
            controls
            class="audio-player">
          </audio>
          <div class="recording-duration">
            Duration: {{audioPreviewDuration}}
          </div>
        </div>

        <div class="preview-actions">
          <button class="btn-cancel" (click)="cancelRecording()">
            <span class="icon">ğŸ—‘ï¸</span>
            Delete & Re-record
          </button>
          <button class="btn-send" (click)="confirmSendAudio()">
            <span class="icon">âœ“</span>
            Send Recording
          </button>
        </div>
      </div>
    </div>

    <div class="input-area">
      <!-- Recording Status - Shows ONLY when recording -->
      <div class="recording-status" *ngIf="isRecording">
        <div class="recording-pulse"></div>
        <span class="recording-time">{{ recordingTime }}</span>
        <span class="recording-label">Recording...</span>
      </div>

      <!-- Text Input - Shows when NOT recording -->
      <textarea
        *ngIf="!isRecording"
        [(ngModel)]="messageInput"
        (keydown)="onKeyDown($event)"
        placeholder="Type your message..."
        rows="1"
        class="message-input"
      ></textarea>

      <div class="action-buttons">
        <button 
          class="mic-btn" 
          [class.recording]="isRecording"
          (click)="toggleRecording()"
          [disabled]="showAudioPreview"
          [title]="isRecording ? 'Stop Recording' : 'Record voice message'">
          {{ isRecording ? 'â¹' : 'ğŸ™ï¸' }}
        </button>
        <button 
          class="send-btn" 
          (click)="sendMessage()"
          [disabled]="!messageInput.trim() || isRecording || showAudioPreview"
          title="Send message">
          â¤
        </button>
      </div>
    </div>
  </div>
</div>