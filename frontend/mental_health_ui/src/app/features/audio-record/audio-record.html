<app-sidebar></app-sidebar>

<div class="chat-page">
  <div class="chat-container">
    <div class="chat-header">
      <h2>ğŸ’™ Mental Health Support</h2>
      <p>I'm here to listen and support you</p>
      <div class="emotion-status">
        {{ emotionStatus }}
      </div>
    </div>

    <div class="messages-container" #messagesContainer>
      <div 
        *ngFor="let message of messages" 
        class="message"
        [class.user]="message.isUser"
        [class.bot]="!message.isUser">
        <div class="message-bubble">
          <div class="message-text">{{ message.text }}</div>
          <div 
            *ngIf="message.emotion && message.isUser" 
            class="emotion-badge"
            [ngClass]="getEmotionClass(message.emotion)">
            Detected: {{ message.emotion }}
          </div>
          <div class="message-time">{{ message.time }}</div>
        </div>
      </div>

      <div class="typing-indicator" [class.active]="isTyping">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>

    <div class="input-area">
      <!-- Recording Status - Shows ONLY when recording -->
      <div class="recording-status" *ngIf="isRecording">
        <div class="recording-pulse"></div>
        <span class="recording-time">{{ recordingTime }}</span>
        <span class="recording-label">Recording...</span>
      </div>

      <!-- Text Input - Shows when NOT recording -->
      <textarea
        *ngIf="!isRecording"
        [(ngModel)]="messageInput"
        (keydown)="onKeyDown($event)"
        placeholder="Type your message..."
        rows="1"
        class="message-input"
      ></textarea>

      <div class="action-buttons">
        <button 
          class="mic-btn" 
          [class.recording]="isRecording"
          (click)="toggleRecording()"
          [title]="isRecording ? 'Stop Recording' : 'Record voice message'">
          {{ isRecording ? 'â¹' : 'ğŸ™ï¸' }}
        </button>
        <button 
          class="send-btn" 
          (click)="sendMessage()"
          [disabled]="!messageInput.trim() || isRecording"
          title="Send message">
          â¤
        </button>
      </div>
    </div>
  </div>
</div>